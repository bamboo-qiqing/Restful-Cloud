package com.bamboo.tool.components.api.framework.odianyun.annotations;

import com.bamboo.tool.components.api.entity.ApiClass;
import com.bamboo.tool.components.api.entity.ApiMethod;
import com.bamboo.tool.components.api.enums.FrameworkType;
import com.bamboo.tool.components.api.enums.InterfaceType;
import com.bamboo.tool.components.api.enums.MethodAnnotationType;
import com.bamboo.tool.components.api.enums.RequestMethod;
import com.bamboo.tool.components.api.factory.MethodAnnotationProcess;
import com.bamboo.tool.util.StringUtil;
import com.intellij.psi.PsiAnnotation;
import com.intellij.psi.PsiNameValuePair;

import java.util.ArrayList;
import java.util.List;
import java.util.Objects;

public class SoaMethodRegister implements MethodAnnotationProcess {
    @Override
    public void buildMethod(ApiMethod apiMethod, PsiAnnotation annotation, ApiClass apiClass) {
        apiMethod.getTypes().add(getFrameworkType().getCode());
        apiMethod.getTypes().add(InterfaceType.SERVICE.getCode());
        apiMethod.getMethodTypes().add(RequestMethod.ALL.getCode());
        PsiNameValuePair[] pairs = annotation.getParameterList().getAttributes();
        if (pairs == null && pairs.length < 1) {
            return;
        }
        for (PsiNameValuePair pair : pairs) {
            String attributeName = pair.getName();
            if (Objects.equals(attributeName, "desc")) {
                apiMethod.setDescription(pair.getValue().getText());
            }
        }
        apiMethod.getMethodUrls().add(apiMethod.getMethodName());
    }

    @Override
    public MethodAnnotationType getMethodAnnotationType() {
        return MethodAnnotationType.SOA_METHOD_REGISTER;
    }

    @Override
    public String getClassShortName() {
        return "SoaMethodRegister";
    }

    @Override
    public FrameworkType getFrameworkType() {
        return FrameworkType.O_DIAN_YUN;
    }

    public static void main(String[] args) {
        List<String> list = new ArrayList<>();
        String s = "db.getCollection('user_red_packet_record').updateOne({\"activityId\":2201250000724126, \"num\":4, \"userId\":{}},{$set:{'isSend':1}})";
        String data="1001104001000314,1001104101000038,1001104101020936,1001104201000299,1001104201001442,1001104601001712,1001104601002550,1001107101001347,1001107501000024,1001108301000301,1001109601000728,1001110201000839,1001111501000320,1001111501000364,1001113201000749,1001113401000080,1001114201000302,1001115001000653,1001115401000122,1001116901000480,1001116901007646,1001117301000896,1001117601003023,1001117901000316,1001118101000077,1001118101000963,1001118701003115,1001118701003192,1001119101000184,1001119101001113,1001119201000107,1001120601002133,1001121701001352,1001122801001774,1001122901000363,1001123101000985,1001123701000922,1001123701002661,1001123801000310,1001124101000503,1001124301000020,1001125101002377,1001125201000425,1001125201000446,1001125201002472,1001125301004390,1001125401000910,1001125501000828,1001125501003816,1001125701001931,1001125801002754,1001125901004891,1001127501002105,1001128701003378,1001129901000771,1001130401000118,1001130701003505,1001132001001442,1001133201001861,1001133701001531,1001133901000324,1001134201002195,1001135101004798,1001135101009678,1001135601001737,1001136101002447,1001137501000893,1001137601001074,1001137801023972,1001138201003334,1001139101001128,1001139201003963,1001139501002226,1001139701002616,1001142001004434,1001142101000212,1001146601002079,1001146901003157,1001147400000526,1001147400003382,1001150301010036,1001150401009565,1001150401013132,1001150401016218,1001150901000988,1001151101003690,1001151101004570,1001151601002443,1001151601007373,1001151601010798,1001151801006835,1001152501004690,1001153201001079,1001153201001173,1001153501001969,1001153701001432,1001154001000417,1001154001003144,1001154701005881,1001155001000764,1001155401002108,1001155901002421,1001156001011841,1001156501001117,1001156701002584,1001156801004954,1001157501003140,1001158901006021,1001159001000686,1001159001004399,1001159801001802,1001160601004975,1001160701000989,1001160801002011,1001160901007609,1001162201000676,1001163001001016,1001163001016196,1001163101003246,1001163101003269,1001163201005601,1001163701005371,1001163901003456,1001164001001846,1001164401005511,1001164501006096,1001164901002937,1001165001001300,1001165001003230,1001165401001768,1001165801001396,1001165801001683,1001166501000597,1001166501001389,1001166901002898,1001167301004628,1001167301007587,1001167701002259,1001167901005367,1001168200001226,1002099601000022,1002104101000274,1002104101001967,1002104101005336,1002104101005407,1002104101007232,1002104101015621,1002104301004724,1002104401001631,1002105301000468,1002106001001506,1002106701000436,1002107101000227,1002107701000800,1002108801000191,1002109701000511,1002111301000609,1002111501000623,1002111801000151,1002112101000497,1002112501000297,1002112801000488,1002114001000186,1002114501000211,1002114601000555,1002115601000121,1002115601000693,1002115601000780,1002115601000846,1002115801000480,1002116901000377,1002116901016427,1002117501001912,1002118201000190,1002118201000551,1002118201008602,1002118301000456,1002118901001694,1002119001000679,1002119101000661,1002119101000694,1002119201000799,1002120401005239,1002122101002937,1002122501000039,1002122501002662,1002123001000672,1002123501000082,1002124701000375,1002125201000847,1002125401000640,1002125401001111,1002125401002337,1002125801000689,1002126101003983,1002127101001579,1002128201002173,1002128301001836,1002128401000535,1002128401001564,1002129601002274,1002131801000274,1002133401001670,1002133601002767,1002136301003241,1002136801000843,1002137201001175,1002137601000896,1002137701001577,1002139901002736,1002140201000550,1002140301002112,1002141301002239,1002141401001783,1002141701003999,1002141801001354,1002142801000837,1002144201003648,1002144801003336,1002146001000372,1002146301001898,1002148201002052,1002148701000347,1002149501002035,1002150101006824,1002150401001152,1002151601000687,1002152101003171,1002152201000765,1002154701001095,1002154701002084,1002157501005925,1002158501001527,1002159001000674,1002159001003270,1002159101000603,1002160501000626,1002160501006657,1002161401000265,1002162101000041,1002162201002341,1002162501003162,1002162701009780,1002163101015541,1002163101016324,1002163101016928,1002163301002349,1002163301007084,1002163401000471,1002163401006443,1002163501003935,1002164101008045,1002166101001960,1002166401000923,1002166501000190,1002166801001480,1002167101000050,1002167101000437,1002167301003436,1002167901008119,1002168501000502,1002168601000363,1005125200003391,2103210001377942,2103210001679386,2103230001462416,2103240001232666,2103250001638290,2103270002311241,2103270002380345,2103290001834469,2103310001961859,2104020002001356,2104030002084361,2104040001514350,2104040001899312,2104080001963185,2104090001994034,2104100001995784,2104120001424916,2104130001175399,2104140002226055,2104170001286108,2104170002472769,2104170002592391,2104180001476696,2104180002760210,2104200001418785,2104210002505911,2104240002256048,2104240002549617,2104250001642147,2104270002224409,2105010001821651,2105030002042372,2105070001446671,2105190001290590,2105190001727762,2105240002204787,2105240002437342,2105270002271106,2106050002035640,2106060001608832,2106100001461162,2106190001461740,2106200002279809,2106200002280043,2106210002195950,2106220001711568,2106220002048162,2106230002982823,2106240002190792,2106250002441387,2106250002639393,2106250003412820,2106260001832874,2106260002460371,2106260003625409,2106270001643733,2106270003267931,2106270003543388,2106290002824280,2107010001575975,2107010001618158,2107030001465512,2107030002279930,2107030002596853,2107040002420675,2107080002277143,2107080002591376,2107090001951073,2107130001645327,2107130002636906,2107210001928745,2107220001626815,2107230002948752,2107260001856016,2107270001869787,2107280001466703,2107300002678809,2108010001535949,2108010001618900,2108090001445290,2108090002603571,2108130001757003,2108150002625057,2108190001669672,2108210002183607,2108220001343778,2108240002524695,2108250001936078,2108260002341967,2109020002634808,2109030003071638,2109040001582251,2109040002192970,2109040002478409,2109050001818560,2109060002082417,2109060002418590,2109060002577715,2109060003167104,2109070001956882,2109070002119745,2109070002607614,2109080001978782,2109080002687514,2109080002800155,2109090002570173,2109090003145039,2109100003640092,2109110002577678,2109120002004837,2109120002697801,2109120003325962,2109120003702963,2109120003714302,2109130001571017,2109150002317931,2109160001542920,2109160002581852,2109170001680758,2109170002792773,2109180001620575,2109180002439039,2109180003045329,2109220002372927,2109220003184172,2109240002106773,2109240003283167,2109250001648305,2109250001915376,2109250001932160,2109250002820935,2109260003034328,2109260003693453,2109270002526235,2109270002857721,2109280002246895,2109280002273024,2109290003569945,2110010002486259,2110010004218140,2110010004228304,2110040002895306,2110040003117990,2110040003138903,2110060003525097,2110080002664271,2110100003440726,2110100003537979,2110110002044576,2110120002091889,2110120003037250,2110120003204669,2110140002928911,2110150002544877,2110170002089964,2110170002354144,2110180003226240,2110180003573915,2110190003639225,2110200001763669,2110210003072923,2110220001758283,2110290002407305,2110290002422260,2110300002836502,2110310003588775,2111040002681913,2111040003715381,2111050002869702,2111070002816529,2111070003148238,2111080002681087,2111090002195925,2111100002392629,2111110001983653,2111110002602772,2111130003840607,2111140002598185,2111170002438125,2111170002925610,2111200001756225,2111200002985596,2111200003426051,2111210003052395,2111220002466881,2111220002899590,2111220003173119,2111230002192360,2111230003043679,2111270002659887,2111290002662094,2112030003619740,2112040002057292,2112060002175550,2112060002597004,2112060003437844,2112080002399846,2112130001844408,2112130002258695,2112150002092205,2112160002399356,2112160002685975,2112160003725116,2112170002166187,2112170002252776,2112180002237025,2112190003034015,2112190003038259,2112190003394602,2112200002332489,2112200002853049,2112210002856814,2112210002875623,2112230000402758,2112230001853353,2112230001967346,2112230002715314,2112230002862782,2112240004593839,2112260003426290,2112270003069584,2112280002763447,2112290002442222,2112290002648639,2112290003462088,2112300002474176,2112310002279623,2201010002472913,2201010002511160,2201010002591660,2201010003327920,2201020002552878,2201020002556521,2201020002843504,2201020003075634,2201030002875006,2201050002484538,2201050003139281,2201060003081075,2201060003195847,2201070003232245,2201070003470870,2201080003766885,2201110003153306,2201110003979474,2201120002118518,2201120002569488,2201130002323245,2201140003229449,2201160003001902,2201160004036002,2201170002671706,2201180002808443,2201180002852734,2201190002024051,2201190002577354,2201190003097523,2201210002616694,2201230003126918,2201230003717944,2201230003864722,2201230004607864,2201240001914061,2201240002560511,2201250002240997,2201250002337372,2201250003332322,2201250003640908,2201250004393782,2201260002814993,2201260003132194,2201280002542004,2201280002954833,2201280004071371,2201280004727474,2201290003527490,2202010002208175,2202010002402871,2202010003242489,2202010003807218,2202020002516421,2202020002968588,2202020003035710,2202020003262023,2202030002219571,2202030002732159,2202030002820499,2202030002914669,2202030003108276,2202030003135810,2202030003201427,2202030003230111,2202030003522198,2202030003528769,2202030003997228,2202030004018330,2202040002126434,2202040002224991,2202040003186624,2202050002552882,2202050003503523,2202060002650401,2202060002825396,2202060003046685,2202060003949450,2202070002198649,2202070002551964,2202070003636090,2202070004207599,2202070004208319,2202080002279274,2202080002381399,2202080002419330,2202080002438196,2202080002477707,2202080002647253,2202080003313563,2202090002008818,2202090002763792,2202090003663849,2202090003888814,2202090004220490,2202100002209693,2202100002237218,2202100002260701,2202100002266103,2202100002295787,2202100002297458,2202100002299671,2202100002307056,2202100002308247,2202100002308270,2202100002309554,2202100002316503,2202100002349659,2202100002398724,2202100002410150,2202100002414950,2202100002415831,2202100002446933,2202100002449043,2202100002458434,2202100002458530,2202100002462268,2202100002473088,2202100002474552,2202100002480199,2202100002484630,2202100002535284,2202100002536195,2202100002536273,2202100002561917,2202100002570450,2202100002619738,2202100002622195,2202100002626024,2202100002627354,2202100002653118,2202100002658852,2202100002659140,2202100002661641,2202100002668468,2202100002702129,2202100002702327,2202100002704724,2202100002705016,2202100002710789,2202100002711355,2202100002711608,2202100002730798,2202100002733375,2202100002735798,2202100002736725,2202100002738873,2202100002740069,2202100002740625,2202100002740700,2202100002750538,2202100002750966,2202100002751435,2202100002754892,2202100002755285,2202100002755411,2202100002757735,2202100002757972,2202100002761766,2202100002762293,2202100002762423,2202100002764949,2202100002765276,2202100002767833,2202100002768288,2202100002769127,2202100002774955,2202100002779892,2202100002780522,2202100002790618,2202100002791822,2202100002795144,2202100002800348,2202100002805365,2202100002814192,2202100002816755,2202100002817003,2202100002824591,2202100002825434,2202100002826412,2202100002827895";
        String[] split = data.split(",");
        for (int i = 0; i < split.length; i++) {
            String format = StringUtil.format(s, split[i]);
            list.add(format);
        }
        System.out.printf(list.toString());
    }
}
